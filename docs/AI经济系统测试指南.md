# AI ç»æµç³»ç»Ÿ - æµ‹è¯•æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—æä¾›äº†æµ‹è¯•é‡æ„åçš„ AI ç»æµç³»ç»Ÿå¹¶ä¸æ—§ç³»ç»Ÿè¿›è¡Œå¯¹æ¯”çš„è¯´æ˜ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å¯ç”¨æ–°ç³»ç»Ÿ

1. æ‰“å¼€ `src/logic/simulation.js`
2. æ‰¾åˆ°ç‰¹æ€§å¼€å…³ï¼ˆå¤§çº¦åœ¨ç¬¬ 30 è¡Œï¼‰ï¼š
   ```javascript
   const USE_NEW_AI_ECONOMY = false; // TODO: Enable after testing
   ```
3. æ”¹ä¸º `true`ï¼š
   ```javascript
   const USE_NEW_AI_ECONOMY = true; // Testing new system
   ```
4. ä¿å­˜å¹¶é‡å¯æ¸¸æˆ

### å¯ç”¨è°ƒè¯•æ¨¡å¼

æŸ¥çœ‹è¯¦ç»†çš„ç»æµæ›´æ–°ä¿¡æ¯ï¼š

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æˆ–æ·»åŠ åˆ° simulation.js
import { EconomyDebugger } from './logic/diplomacy/economy/index.js';
EconomyDebugger.enable();
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯• 1ï¼šåŸºæœ¬å¢é•¿

**ç›®æ ‡**ï¼šéªŒè¯ AI å›½å®¶çš„äººå£å’Œè´¢å¯Œæ­£ç¡®å¢é•¿

**æ­¥éª¤**ï¼š
1. å¼€å§‹æ–°æ¸¸æˆ
2. è¿è¡Œ 100 ticksï¼ˆ10 æ¬¡å¢é•¿æ›´æ–°ï¼‰
3. æ£€æŸ¥ AI å›½å®¶ç»Ÿè®¡æ•°æ®

**é¢„æœŸç»“æœ**ï¼š
- äººå£åº”è¯¥é€æ¸å¢åŠ 
- è´¢å¯Œåº”è¯¥éšäººå£å¢åŠ 
- å¢é•¿ç‡åº”è¯¥åˆç†ï¼ˆæ¯æ¬¡æ›´æ–° 1-3%ï¼‰

**éªŒè¯æ–¹æ³•**ï¼š
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­
const aiNation = nations.find(n => n.id === 'some_ai_nation');
console.log({
    population: aiNation.population,
    wealth: aiNation.wealth,
    perCapita: aiNation.wealth / aiNation.population,
    epoch: aiNation.epoch
});
```

### æµ‹è¯• 2ï¼šæˆ˜äº‰æƒ©ç½š

**ç›®æ ‡**ï¼šéªŒè¯æˆ˜äº‰é™ä½å¢é•¿ç‡

**æ­¥éª¤**ï¼š
1. ä¸ AI å›½å®¶å¼€æˆ˜
2. è§‚å¯Ÿæˆ˜äº‰æœŸé—´çš„å¢é•¿ç‡
3. å’Œå¹³
4. è§‚å¯Ÿå’Œå¹³åçš„å¢é•¿ç‡

**é¢„æœŸç»“æœ**ï¼š
- æˆ˜äº‰æœŸé—´çš„å¢é•¿åº”è¯¥æ˜¯å’Œå¹³æ—¶æœŸçš„çº¦ 30%
- å’Œå¹³åå¢é•¿åº”è¯¥æ¢å¤
- äººå£ä¸åº”è¯¥å¿«é€Ÿä¸‹é™

### æµ‹è¯• 3ï¼šèµ„æºç®¡ç†

**ç›®æ ‡**ï¼šéªŒè¯èµ„æºåº“å­˜æ­£ç¡®æ›´æ–°

**æ­¥éª¤**ï¼š
1. æ£€æŸ¥å¼€å§‹æ—¶çš„ AI å›½å®¶åº“å­˜
2. è¿è¡Œæ¸¸æˆ 50 ticks
3. å†æ¬¡æ£€æŸ¥åº“å­˜

**é¢„æœŸç»“æœ**ï¼š
- åº“å­˜åº”è¯¥åœ¨ç›®æ ‡æ°´å¹³é™„è¿‘æ³¢åŠ¨
- ç‰¹äº§èµ„æºï¼ˆbias > 1ï¼‰åº”è¯¥æœ‰æ›´é«˜çš„åº“å­˜
- ç¨€ç¼ºèµ„æºï¼ˆbias < 1ï¼‰åº”è¯¥æœ‰æ›´ä½çš„åº“å­˜

**éªŒè¯æ–¹æ³•**ï¼š
```javascript
const aiNation = nations.find(n => n.id === 'some_ai_nation');
console.log({
    inventory: aiNation.inventory,
    resourceBias: aiNation.economyTraits?.resourceBias
});
```

### æµ‹è¯• 4ï¼šæ—¶ä»£è¿›æ­¥

**ç›®æ ‡**ï¼šéªŒè¯ AI å›½å®¶æ¨è¿›æ—¶ä»£

**æ­¥éª¤**ï¼š
1. ä»çŸ³å™¨æ—¶ä»£å¼€å§‹æ¸¸æˆ
2. å¿«è¿› 500+ ticks
3. æ£€æŸ¥ AI å›½å®¶çš„æ—¶ä»£

**é¢„æœŸç»“æœ**ï¼š
- AI å›½å®¶åº”è¯¥è¿›å…¥é’é“œæ—¶ä»£
- è´¢å¯Œä¸Šé™åº”è¯¥éšæ—¶ä»£å¢åŠ 
- å¢é•¿ç‡åº”è¯¥éšæ—¶ä»£å¢åŠ 

### æµ‹è¯• 5ï¼šé™„åº¸å¢é•¿

**ç›®æ ‡**ï¼šéªŒè¯é™„åº¸æ­£ç¡®å¢é•¿

**æ­¥éª¤**ï¼š
1. ä½¿ä¸€ä¸ª AI å›½å®¶æˆä¸ºé™„åº¸
2. è§‚å¯Ÿ 100 ticks å†…çš„å¢é•¿
3. ä¸ç‹¬ç«‹å›½å®¶å¯¹æ¯”

**é¢„æœŸç»“æœ**ï¼š
- é™„åº¸åº”è¯¥ä»¥ä¸ç‹¬ç«‹å›½å®¶ç›¸ä¼¼çš„é€Ÿç‡å¢é•¿
- é™„åº¸æ»¡æ„åº¦åº”è¯¥æ­£ç¡®è®¡ç®—
- è´¡å“åº”è¯¥å®šæœŸæ”¯ä»˜

### æµ‹è¯• 6ï¼šä¿å­˜/åŠ è½½å…¼å®¹æ€§

**ç›®æ ‡**ï¼šéªŒè¯æ—§å­˜æ¡£æ­£ç¡®åŠ è½½

**æ­¥éª¤**ï¼š
1. åŠ è½½æ—§å­˜æ¡£ï¼ˆé‡æ„å‰çš„ï¼‰
2. æ£€æŸ¥ AI å›½å®¶æ•°æ®
3. è¿è¡Œæ¸¸æˆ 50 ticks
4. ä¿å­˜å¹¶é‡æ–°åŠ è½½

**é¢„æœŸç»“æœ**ï¼š
- æ—§å­˜æ¡£åº”è¯¥æ— é”™è¯¯åŠ è½½
- è¿ç§»åº”è¯¥è‡ªåŠ¨è¿›è¡Œ
- æ•°æ®åº”è¯¥æ­£ç¡®ä¿ç•™
- æ–°å­˜æ¡£åº”è¯¥æ­£å¸¸å·¥ä½œ

## ğŸ“Š å¯¹æ¯”æµ‹è¯•

### å¹¶æ’å¯¹æ¯”

å¯¹æ¯”æ–°æ—§ç³»ç»Ÿï¼š

1. **ä½¿ç”¨æ—§ç³»ç»Ÿæµ‹è¯•**ï¼š
   - è®¾ç½® `USE_NEW_AI_ECONOMY = false`
   - å¼€å§‹æ–°æ¸¸æˆ
   - æ¯ 100 ticks è®°å½• AI å›½å®¶ç»Ÿè®¡æ•°æ®
   - å°†æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶

2. **ä½¿ç”¨æ–°ç³»ç»Ÿæµ‹è¯•**ï¼š
   - è®¾ç½® `USE_NEW_AI_ECONOMY = true`
   - å¼€å§‹æ–°æ¸¸æˆï¼ˆå¦‚å¯èƒ½ä½¿ç”¨ç›¸åŒç§å­ï¼‰
   - æ¯ 100 ticks è®°å½• AI å›½å®¶ç»Ÿè®¡æ•°æ®
   - å°†æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶

3. **å¯¹æ¯”ç»“æœ**ï¼š
   - äººå£å¢é•¿ç‡
   - è´¢å¯Œå¢é•¿ç‡
   - èµ„æºåº“å­˜æ°´å¹³
   - æ—¶ä»£è¿›æ­¥æ—¶æœº

### æ•°æ®æ”¶é›†è„šæœ¬

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ·»åŠ 
const collectEconomyData = () => {
    const data = nations
        .filter(n => !n.isPlayer)
        .map(n => ({
            name: n.name,
            population: n.population,
            wealth: n.wealth,
            epoch: n.epoch,
            perCapita: n.wealth / n.population,
            inventory: Object.keys(n.inventory || {}).length,
            isAtWar: n.isAtWar,
            isVassal: !!n.vassalOf
        }));
    
    console.table(data);
    return data;
};

// æ¯ 100 ticks è¿è¡Œä¸€æ¬¡
setInterval(() => {
    console.log(`=== Tick ${tick} ===`);
    collectEconomyData();
}, 10000); // æ ¹æ®éœ€è¦è°ƒæ•´æ—¶é—´
```

## ğŸ› éœ€è¦æ³¨æ„çš„å·²çŸ¥é—®é¢˜

### é—®é¢˜ 1ï¼šé‡å¤å¢é•¿

**ç—‡çŠ¶**ï¼šAI å›½å®¶å¢é•¿è¿‡å¿«
**åŸå› **ï¼šä¸¤ä¸ªç³»ç»ŸåŒæ—¶è¿è¡Œ
**æ£€æŸ¥**ï¼šéªŒè¯ç‰¹æ€§å¼€å…³è®¾ç½®æ­£ç¡®

### é—®é¢˜ 2ï¼šæ— å¢é•¿

**ç—‡çŠ¶**ï¼šAI å›½å®¶å®Œå…¨ä¸å¢é•¿
**åŸå› **ï¼šè¿ç§»å¤±è´¥æˆ–æ•°æ®æŸå
**æ£€æŸ¥**ï¼šæŸ¥æ‰¾æ§åˆ¶å°ä¸­çš„éªŒè¯é”™è¯¯

### é—®é¢˜ 3ï¼šåº“å­˜çˆ†ç‚¸

**ç—‡çŠ¶**ï¼šèµ„æºåº“å­˜æ— é™å¢é•¿
**åŸå› **ï¼šç”Ÿäº§/æ¶ˆè€—ä¸å¹³è¡¡
**æ£€æŸ¥**ï¼šéªŒè¯åº“å­˜ä¸Šé™æ˜¯å¦ç”Ÿæ•ˆ

### é—®é¢˜ 4ï¼šè´Ÿå€¼

**ç—‡çŠ¶**ï¼šäººå£æˆ–è´¢å¯Œå˜ä¸ºè´Ÿæ•°
**åŸå› **ï¼šéªŒè¯æœªæ•è·è¾¹ç•Œæƒ…å†µ
**æ£€æŸ¥**ï¼šæŸ¥æ‰¾éªŒè¯é”™è¯¯

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•

### éœ€è¦è·Ÿè¸ªçš„æŒ‡æ ‡

1. **å¸§ç‡**ï¼šåº”è¯¥ä¿æŒç¨³å®š
2. **Tick æŒç»­æ—¶é—´**ï¼šä¸åº”è¯¥æ˜¾è‘—å¢åŠ 
3. **å†…å­˜ä½¿ç”¨**ï¼šä¸åº”è¯¥éšæ—¶é—´å¢é•¿
4. **CPU ä½¿ç”¨**ï¼šåº”è¯¥ä¸æ—§ç³»ç»Ÿç›¸ä¼¼

### æ€§èƒ½æµ‹è¯•è„šæœ¬

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ·»åŠ 
const perfTest = () => {
    const start = performance.now();
    
    // è¿è¡Œ 100 ticks
    for (let i = 0; i < 100; i++) {
        // è§¦å‘æ¨¡æ‹Ÿæ›´æ–°
        // ï¼ˆå…·ä½“å®ç°å–å†³äºä½ çš„æ¸¸æˆå¾ªç¯ï¼‰
    }
    
    const end = performance.now();
    const duration = end - start;
    const avgPerTick = duration / 100;
    
    console.log({
        totalDuration: `${duration.toFixed(2)}ms`,
        avgPerTick: `${avgPerTick.toFixed(2)}ms`,
        ticksPerSecond: (1000 / avgPerTick).toFixed(2)
    });
};
```

## âœ… éªŒæ”¶æ ‡å‡†

å½“ä»¥ä¸‹æ¡ä»¶æ»¡è¶³æ—¶ï¼Œæ–°ç³»ç»Ÿå°±å¯ä»¥æŠ•å…¥ç”Ÿäº§ï¼š

- [ ] æ‰€æœ‰æµ‹è¯•åœºæ™¯é€šè¿‡
- [ ] å¢é•¿ç‡ä¸æ—§ç³»ç»ŸåŒ¹é…ï¼ˆÂ±5%ï¼‰
- [ ] èµ„æºç®¡ç†æ­£å¸¸å·¥ä½œ
- [ ] æ—§å­˜æ¡£æ— é”™è¯¯åŠ è½½
- [ ] æ€§èƒ½ç›¸åŒæˆ–ä¼˜äºæ—§ç³»ç»Ÿ
- [ ] æ— æ§åˆ¶å°é”™è¯¯æˆ–è­¦å‘Š
- [ ] é™„åº¸æ­£ç¡®å¢é•¿
- [ ] æ—¶ä»£è¿›æ­¥æ­£å¸¸å·¥ä½œ
- [ ] æˆ˜äº‰æƒ©ç½šæ­£ç¡®åº”ç”¨
- [ ] 1000+ ticks åæ— å†…å­˜æ³„æ¼

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ§åˆ¶å°é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼šæ„å¤–è¡Œä¸º

**è§£å†³æ–¹æ¡ˆ**ï¼šå¯ç”¨è°ƒè¯•æ¨¡å¼å¹¶æ£€æŸ¥æ—¥å¿—

### é—®é¢˜ï¼šæ€§èƒ½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨æµè§ˆå™¨å¼€å‘å·¥å…·è¿›è¡Œåˆ†æ

### é—®é¢˜ï¼šæ•°æ®æŸå

**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥éªŒè¯é”™è¯¯ï¼Œå¯èƒ½éœ€è¦é‡ç½®å­˜æ¡£

## ğŸ“ é—®é¢˜æŠ¥å‘Š

æŠ¥å‘Šé—®é¢˜æ—¶ï¼Œè¯·åŒ…å«ï¼š

1. **ç³»ç»Ÿ**ï¼šæ–°ç³»ç»Ÿæˆ–æ—§ç³»ç»Ÿï¼ˆç‰¹æ€§å¼€å…³å€¼ï¼‰
2. **åœºæ™¯**ï¼šä½ æ­£åœ¨æµ‹è¯•ä»€ä¹ˆ
3. **é¢„æœŸ**ï¼šåº”è¯¥å‘ç”Ÿä»€ä¹ˆ
4. **å®é™…**ï¼šå®é™…å‘ç”Ÿäº†ä»€ä¹ˆ
5. **æ§åˆ¶å°æ—¥å¿—**ï¼šä»»ä½•é”™è¯¯æˆ–è­¦å‘Š
6. **å­˜æ¡£æ–‡ä»¶**ï¼šå¦‚æœé€‚ç”¨
7. **é‡ç°æ­¥éª¤**ï¼šè¯¦ç»†æ­¥éª¤

## ğŸ¯ æµ‹è¯•åçš„ä¸‹ä¸€æ­¥

1. **å¦‚æœæµ‹è¯•é€šè¿‡**ï¼š
   - é»˜è®¤å¯ç”¨æ–°ç³»ç»Ÿ
   - ç›‘æ§é—®é¢˜
   - æ”¶é›†ç©å®¶åé¦ˆ

2. **å¦‚æœæµ‹è¯•å¤±è´¥**ï¼š
   - è®°å½•é—®é¢˜
   - ä¿®å¤ bug
   - é‡æ–°æµ‹è¯•
   - é‡å¤ç›´åˆ°é€šè¿‡

3. **æˆåŠŸæ¨å‡ºå**ï¼š
   - ç§»é™¤æ—§ä»£ç 
   - æ›´æ–°æ–‡æ¡£
   - ä¼˜åŒ–æ€§èƒ½

---

**æœ€åæ›´æ–°**ï¼š2026-02-03  
**çŠ¶æ€**ï¼šå‡†å¤‡æµ‹è¯•  
**ç‰¹æ€§å¼€å…³**ï¼š`USE_NEW_AI_ECONOMY` åœ¨ `simulation.js` ä¸­
