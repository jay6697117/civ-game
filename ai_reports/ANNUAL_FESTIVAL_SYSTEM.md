# 年度庆典系统 (Annual Festival System)

## 📖 系统概述

年度庆典系统是一个周期性事件机制，每个游戏年度自动触发一次盛大庆典。玩家可以从三个随机效果中选择一个，为文明带来短期或永久的加成。这个系统为游戏增添了策略深度和随机性，让每次游戏体验都独一无二。

## 🎯 设计目标

1. **周期性奖励** - 为玩家提供定期的正向反馈和期待感
2. **策略选择** - 需要根据当前发展状况做出最优选择
3. **时代适配** - 效果与当前时代背景相匹配，增强沉浸感
4. **长短期平衡** - 在即时收益和长远发展之间权衡

## 🎊 功能机制

### 触发条件
- **时间周期**: 每个游戏年度（360天）自动触发一次
- **触发时机**: 每年的第1天（dayOfYear === 1）
- **触发方式**: 系统自动弹出庆典模态框

### 效果类型

#### 短期效果 (Temporary)
- **持续时间**: 整整一年（360天）
- **特点**: 效果强大，但有时限
- **适用场景**: 需要快速发展或度过难关时
- **标识**: ⏱ 黄色/橙色主题

#### 永久效果 (Permanent)
- **持续时间**: 从获得后永久生效
- **特点**: 效果相对温和，但永久累积
- **适用场景**: 追求长期稳定发展
- **标识**: ♾️ 紫色主题

### 效果来源
所有效果预先设计在总效果表中（`festivalEffects.js`），按时代分类：
- 石器时代 (Epoch 0): 3个效果
- 青铜时代 (Epoch 1): 3个效果
- 古典时代 (Epoch 2): 3个效果
- 封建时代 (Epoch 3): 3个效果
- 探索时代 (Epoch 4): 3个效果
- 启蒙时代 (Epoch 5): 3个效果
- 工业时代 (Epoch 6): 3个效果
- 现代时代 (Epoch 7): 3个效果

## 🎨 效果示例

### 石器时代效果

#### 丰收祝福 (短期)
- **描述**: 祈求大地赐予丰收，粮食和木材产量提升
- **效果**: 采集类建筑 +25%
- **持续**: 1年

#### 生育仪式 (短期)
- **描述**: 举行神圣仪式，人口增长加快
- **效果**: 人口上限 +5
- **持续**: 1年

#### 工具革新 (永久)
- **描述**: 改进石器制作技艺，永久提升生产效率
- **效果**: 全局生产 +5%
- **持续**: 永久

### 工业时代效果

#### 世界博览会 (短期)
- **描述**: 举办国际博览会，全方位提升国力
- **效果**: 
  - 全局生产 +20%
  - 科研产出 +25%
  - 文化产出 +25%
  - 税收收入 +30%
- **持续**: 1年

#### 劳工运动 (短期)
- **描述**: 改善工人待遇，稳定度和生产效率提升
- **效果**: 
  - 稳定度 +25%
  - 工业产出 +20%
- **持续**: 1年

#### 流水线革命 (永久)
- **描述**: 引入流水线生产，永久大幅提升工业产出
- **效果**: 
  - 工业产出 +15%
  - 全局生产 +12%
- **持续**: 永久

## 🎮 使用方法

### 玩家体验流程

1. **庆典触发**
   - 每年第1天，游戏自动暂停（通过模态框）
   - 显示精美的庆典界面
   - 展示当前年份和时代信息

2. **查看选项**
   - 系统随机提供3个效果选项
   - 每个选项显示：
     - 效果名称和图标
     - 效果类型（短期/永久）
     - 详细描述
     - 具体数值加成
     - 风味文本

3. **做出选择**
   - 点击任意选项卡片进行选择
   - 选中的卡片会高亮显示
   - 点击确认按钮应用效果

4. **效果生效**
   - 立即应用到游戏中
   - 添加日志记录
   - 关闭模态框，游戏继续

### 效果管理

#### 激活的效果
- 所有激活的庆典效果存储在 `activeFestivalEffects` 数组中
- 每个效果包含：
  - 效果配置（名称、类型、效果值等）
  - 激活时间戳（用于计算短期效果是否过期）

#### 效果过期
- 系统每秒检查短期效果是否过期
- 过期的效果自动从列表中移除
- 永久效果永不过期

#### 效果应用
- 在 `simulateTick` 中与科技、政令效果一起应用
- 使用相同的 `applyEffects` 函数
- 支持所有效果类型：
  - 建筑加成 (buildings)
  - 类别加成 (categories)
  - 被动收益 (passive)
  - 人口上限 (maxPop)
  - 行政容量 (admin)
  - 全局生产 (production)
  - 工业产出 (industry)
  - 税收收入 (taxIncome)
  - 科研产出 (scienceBonus)
  - 文化产出 (cultureBonus)
  - 军事力量 (militaryBonus)
  - 稳定度 (stability)

## 💡 策略建议

### 早期策略 (石器-青铜时代)
- **优先短期效果**: 快速发展更重要
- **关注资源产出**: 选择提升采集效率的效果
- **人口增长**: 人口上限加成很有价值

### 中期策略 (古典-封建时代)
- **平衡发展**: 根据当前瓶颈选择
- **文化科研**: 开始重视文化和科研产出
- **行政容量**: 如果接近上限，优先选择行政加成

### 后期策略 (探索-现代时代)
- **永久效果优先**: 长期收益更有价值
- **全面提升**: 选择多项加成的综合效果
- **稳定度**: 保持高稳定度以维持效率

### 通用建议
1. **评估当前需求**: 根据当前发展瓶颈选择
2. **考虑时代进度**: 如果即将升级时代，短期效果价值降低
3. **永久效果累积**: 多个永久效果叠加威力巨大
4. **不要贪心**: 有时候简单的效果反而最实用

## 🔧 技术实现

### 文件结构

```
src/
├── config/
│   └── festivalEffects.js          # 庆典效果配置
├── components/
│   └── modals/
│       └── AnnualFestivalModal.jsx # 庆典模态框组件
├── hooks/
│   ├── useGameState.js             # 添加庆典状态
│   └── useGameLoop.js              # 添加庆典触发逻辑
├── logic/
│   └── simulation.js               # 添加效果应用逻辑
└── App.jsx                         # 集成庆典模态框
```

### 数据结构

#### 庆典效果配置
```javascript
{
  id: 'stone_harvest_blessing',
  name: '丰收祝福',
  description: '祈求大地赐予丰收，粮食和木材产量提升',
  icon: 'Wheat',
  type: 'temporary',  // 或 'permanent'
  duration: 360,      // 仅短期效果需要
  effects: {
    categories: {
      gather: 0.25    // 采集类建筑 +25%
    }
  },
  flavorText: '部落长老向天地祈祷，祝福这片土地的收成。'
}
```

#### 游戏状态
```javascript
// 庆典模态框状态
festivalModal: {
  options: [],  // 三个效果选项
  year: number  // 当前年份
}

// 激活的庆典效果
activeFestivalEffects: [
  {
    ...effectConfig,
    activatedAt: number  // 激活时的天数
  }
]

// 上次庆典年份
lastFestivalYear: number
```

### 核心函数

#### `getRandomFestivalEffects(epoch)`
- 根据当前时代获取可用效果
- 随机选择3个效果
- 如果该时代效果少于3个，返回全部

#### `handleFestivalSelect(selectedEffect)`
- 添加时间戳到效果对象
- 加入激活效果列表
- 关闭模态框
- 添加日志

#### 效果应用流程
1. `useGameLoop` 检测年份变化
2. 触发庆典，显示模态框
3. 玩家选择效果
4. 效果加入 `activeFestivalEffects`
5. `simulateTick` 应用所有激活效果
6. 每秒检查并清理过期效果

## 🎨 UI设计特点

1. **醒目的庆典主题** - 使用金色/橙色渐变背景
2. **清晰的效果区分** - 短期用黄色，永久用紫色
3. **详细的信息展示** - 包含描述、数值、风味文本
4. **交互反馈** - 悬停、选中状态的视觉变化
5. **动画效果** - 闪烁的星星图标增加节日氛围

## 🐛 已知问题和未来改进

### 当前版本
- ✅ 基础庆典系统完成
- ✅ 8个时代共24个效果
- ✅ 短期/永久效果机制
- ✅ 自动触发和效果应用
- ✅ 精美的UI界面

### 未来改进方向
- [ ] 添加庆典动画和音效
- [ ] 更多样化的效果类型
- [ ] 特殊事件触发的额外庆典
- [ ] 庆典历史记录查看
- [ ] 成就系统集成
- [ ] 多选项庆典（选择2个效果）
- [ ] 负面事件与正面庆典的平衡

## 📝 更新日志

### v1.0.0 (2025-11-22)
- 初始版本发布
- 实现完整的年度庆典系统
- 8个时代共24个精心设计的效果
- 短期和永久效果机制
- 精美的UI界面和交互体验
