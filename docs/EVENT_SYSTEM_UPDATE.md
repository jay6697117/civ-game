# 事件系统更新说明

## 更新内容

### 1. 事件触发时游戏自动暂停

当任何事件（包括随机事件和外交事件）触发时，游戏会自动暂停，让玩家有充足的时间阅读事件内容并做出选择。

**实现位置**：
- `src/hooks/useGameActions.js` - `triggerRandomEvent()` 和 `triggerDiplomaticEvent()` 函数

### 2. 外交事件系统

AI国家的外交行为现在会以事件的形式展示，包括：

#### 2.1 宣战事件
- **触发条件**：当AI国家对玩家宣战时
- **图标**：Swords（剑）
- **颜色**：蓝紫色渐变（外交事件标识）
- **选项**：只有"应战"一个选项
- **效果**：确认战争状态

#### 2.2 和平请求事件
- **触发条件**：当AI国家在战争中请求和平时
- **图标**：HandHeart（握手）
- **选项**：
  - "接受和平"：结束战争，获得赔款
  - "拒绝和平"：继续战争
- **效果**：根据选择决定是否结束战争

#### 2.3 战斗/突袭事件
- **触发条件**：当AI国家发起突袭时
- **图标**：Shield（盾牌）或 AlertTriangle（警告）
- **选项**：只有"了解"一个选项
- **效果**：展示战斗结果详情

#### 2.4 送礼事件（预留）
- **触发条件**：当AI国家送礼时
- **图标**：Gift（礼物）
- **选项**：只有"接受礼物"一个选项
- **效果**：获得银币

## 技术实现

### 文件修改清单

1. **src/config/events.js**
   - 添加了外交事件创建函数：
     - `createWarDeclarationEvent()` - 创建宣战事件
     - `createGiftEvent()` - 创建送礼事件
     - `createPeaceRequestEvent()` - 创建和平请求事件
     - `createBattleEvent()` - 创建战斗事件

2. **src/config/index.js**
   - 导出新的外交事件创建函数

3. **src/hooks/useGameActions.js**
   - 修改 `triggerRandomEvent()`：添加游戏暂停逻辑
   - 添加 `triggerDiplomaticEvent()`：触发外交事件
   - 修改 `handleEventOption()`：支持外交事件的回调函数

4. **src/hooks/useGameLoop.js**
   - 修改函数签名，接收 `actions` 参数
   - 添加外交事件检测逻辑，监听日志中的外交行为

5. **src/components/modals/EventDetail.jsx**
   - 添加外交事件的视觉区分（蓝紫色渐变）
   - 显示"外交事件"标签

6. **src/App.jsx**
   - 调整 `useGameLoop` 和 `useGameActions` 的调用顺序

## 测试方法

### 测试事件暂停功能

1. 启动游戏
2. 点击顶部控制栏的"事件"按钮（黄色闪电图标）
3. 观察游戏是否自动暂停
4. 选择一个事件选项
5. 确认游戏保持暂停状态（需要手动恢复）

### 测试外交事件

#### 测试宣战事件

1. 启动游戏并发展到时代1或更高
2. 等待AI国家宣战（需要关系较差）
3. 或者使用作弊码降低与某国的关系
4. 当AI宣战时，会弹出宣战事件
5. 游戏自动暂停
6. 点击"应战"确认

#### 测试和平请求事件

1. 与AI国家处于战争状态
2. 在战争中取得优势（提高战争分数）
3. 等待AI请求和平
4. 会弹出和平请求事件
5. 可以选择接受或拒绝

#### 测试突袭事件

1. 与AI国家处于战争状态
2. 等待AI发起突袭
3. 会弹出战斗事件，显示损失详情
4. 点击"了解"确认

## 视觉区分

### 普通事件
- **图标背景**：黄橙色渐变
- **无特殊标签**

### 外交事件
- **图标背景**：蓝紫色渐变
- **标签**："外交事件"（蓝色）

## 注意事项

1. **事件队列**：同一时间只能显示一个事件，如果有多个外交事件同时触发，会按顺序显示
2. **游戏暂停**：事件触发后游戏会自动暂停，处理完事件后需要手动恢复游戏
3. **日志检测**：外交事件通过检测游戏日志来触发，确保日志格式不被修改
4. **回调函数**：外交事件的效果已在simulation中处理，事件选项的回调主要用于确认

## 未来改进

- [ ] 添加更多外交事件类型（贸易协议、联盟请求等）
- [ ] 支持事件队列，允许多个事件排队显示
- [ ] 添加事件历史记录查看功能
- [ ] 为外交事件添加更丰富的选项和后果
- [ ] 添加事件音效和动画效果
- [ ] 支持事件的条件性选项（某些选项需要满足特定条件）

## 调试技巧

1. **查看当前事件**：在浏览器控制台输入 `gameState.currentEvent`
2. **查看事件历史**：在浏览器控制台输入 `gameState.eventHistory`
3. **强制触发事件**：点击"事件"测试按钮
4. **检查日志**：观察游戏日志，确认外交行为是否被正确记录
5. **调试外交事件**：在 `useGameLoop.js` 的外交事件检测代码中添加 `console.log`

## 相关文档

- [事件系统使用指南](./EVENT_SYSTEM_GUIDE.md) - 完整的事件系统文档
- [音效系统指南](../SOUND_SYSTEM_GUIDE.md) - 音效配置说明
